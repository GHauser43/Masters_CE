import numpy as np
import matplotlib.pyplot as plt
import argparse
import csv


# file to plot results from data.csv generated by grid_search script
# inputs: file path(s) (can input multiple file paths to overlay results)
#         xColumn
#         yColumn
#         savePath - if provided, saves the plot this path
def main():
    parser = argparse.ArgumentParser()
    # file(s) to do analysis on
    parser.add_argument(
                '--files',
                nargs='+',
                type=str,
                required=True
                )
    # x and y columns to plot
    parser.add_argument(
                '--xColumn',
                type=str,
                required=True
                )
    parser.add_argument(
                '--yColumn',
                type=str,
                required=True
                )
    # path to save plot to (optional)
    parser.add_argument(
                '--savePath',
                type=str,
                required=False
                )

    args = parser.parse_args()

    for file in args.files:
        print('file:', file)

        with open(file, newline='') as f:
            reader = csv.reader(f)

            header = next(reader)
            print('header:', header)

            try:
                xCol_idx = header.index(args.xColumn)
            except ValueError:
                print(f"Column '{args.xColumn}' not found in header!")
                return 1
            try:
                yCol_idx = header.index(args.yColumn)
            except ValueError:
                print(f"Column '{args.yColumn}' not found in header!")
                return 1

            xValue_array = []
            yValue_array = []
            for row in reader:
                xValue = row[xCol_idx]
                yValue = row[yCol_idx]
                xValue_array.append(float(xValue))
                yValue_array.append(float(yValue))

            plt.plot(xValue_array, yValue_array, '.', label=f"{file}")

    plt.xlabel(f"{args.xColumn}")
    plt.ylabel(f"{args.yColumn}")
    plt.legend()
    plt.tight_layout()

    if args.savePath:
        print(f"Saving plot to: {args.savePath}")
        plt.savefig(args.savePath, dpi=300, bbox_inches='tight')

    plt.show()


if __name__ == "__main__":
    main()
